<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FoodPolio - 마이페이지</title>
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/mypage.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/your-fontawesome-kit.js" crossorigin="anonymous"></script>
    <th:block th:replace="fragments/header :: headerfiles"></th:block>
</head>
<body>
<div th:replace="fragments/header :: header"></div>

<div class="container">
    <!-- 사용자 정보를 동적으로 가져와서 profileHeader 프래그먼트에 전달 -->
    <div th:replace="fragments/mypage_profileHeader :: profileHeader(${user.name}, ${user.location}, ${user.joinDate}, ${reviewCount})"></div>

    <div class="content-wrapper">
        <div class="sidebar">
            <!-- 사용자의 권한에 따라 다른 사이드바 메뉴를 표시 -->
            <div th:replace="fragments/mypage_sidebar :: sidebar(${user.role})"></div>
        </div>

        <div class="main-content">
            <!-- 현재 선택된 탭에 따라 적절한 contentSection을 표시 -->
            <div th:replace="fragments/mypage_contentSection :: contentSection(${selectedTab})"></div>

            <section id="reviews" class="content-section">
                <h2>내가 작성한 리뷰</h2>
                <!-- 사용자가 작성한 리뷰 목록을 동적으로 표시 -->
                <div class="review-list" th:each="review : ${user.reviews}">
                    <div class="review-item">
                        <img th:src="${review.imageUrl}" alt="레스토랑 이미지" class="restaurant-image">
                        <div class="review-content">
                            <h3 th:text="${review.title}">맛있는 파스타</h3>
                            <div class="rating">
                                <i class="fas fa-star" th:each="star : ${#numbers.sequence(1, review.rating)}"></i>
                                <i class="far fa-star" th:each="emptyStar : ${#numbers.sequence(review.rating + 1, 5)}"></i>
                                <span th:text="${review.rating}">4.0</span>
                            </div>
                            <p class="review-text" th:text="${review.text}">파스타가 정말 맛있었어요. 특히 까르보나라가 일품이었습니다.</p>
                            <span class="review-date" th:text="${#dates.format(review.date, 'yyyy년 MM월 dd일')}">2023년 5월 20일</span>
                        </div>
                    </div>
                </div>
            </section>

            <section id="bookmarks" class="content-section">
                <h2>북마크한 레스토랑</h2>
                <!-- 사용자가 북마크한 레스토랑 목록을 동적으로 표시 -->
                <div class="bookmark-list" th:each="bookmark : ${user.bookmarks}">
                    <div class="bookmark-item">
                        <img th:src="${bookmark.imageUrl}" alt="레스토랑 이미지" class="restaurant-image">
                        <div class="bookmark-content">
                            <h3 th:text="${bookmark.name}">정통 이탈리안</h3>
                            <p th:text="${bookmark.location}">인천시 연수구 송도동</p>
                            <div class="rating">
                                <i class="fas fa-star" th:each="star : ${#numbers.sequence(1, bookmark.rating)}"></i>
                                <span th:text="${bookmark.rating}">5.0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
</div>
<!-- 프로필 수정 모달에 현재 사용자 정보를 미리 채워넣기 -->
<div th:replace="fragments/mypage_editProfileModal :: editProfileModal(${user})"></div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const navItems = document.querySelectorAll('.profile-nav li');
        const contentSections = document.querySelectorAll('.content-section');

        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const tab = this.getAttribute('data-tab');

                navItems.forEach(navItem => navItem.classList.remove('active'));
                this.classList.add('active');

                contentSections.forEach(section => {
                    section.classList.remove('active');
                    if (section.id === tab) {
                        section.classList.add('active');
                    }
                });
            });
        });
    });

    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('editProfileModal');
        const btn = document.querySelector('.edit-profile-btn');
        const span = document.getElementsByClassName('close')[0];
        const form = document.getElementById('editProfileForm');

        btn.onclick = function() {
            modal.style.display = "block";
            setTimeout(() => modal.classList.add('show'), 10);
        }

        span.onclick = function() {
            modal.classList.remove('show');
            setTimeout(() => modal.style.display = "none", 300);
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.classList.remove('show');
                setTimeout(() => modal.style.display = "none", 300);
            }
        }

        form.onsubmit = function(e) {
            e.preventDefault();
            // 프로필 수정 폼 제출 처리 로직을 구현
            modal.classList.remove('show');
            setTimeout(() => modal.style.display = "none", 300);
        }
    });
</script>
</body>
</html>
